generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Category {
  id          BigInt    @id @default(autoincrement())
  name        String    @db.VarChar(180)
  description String?   @db.Text
  slug        String?   @db.VarChar(90)
  icon        String?   @db.VarChar(255)
  image       String?   @db.VarChar(255)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamp(0)
  products    Product[]

  @@map("categories")
}

model Product {
  id                    BigInt                    @id @default(autoincrement())
  name                  String                    @db.VarChar(180)
  description           String?                   @db.Text
  price                 Decimal                   @db.Decimal(10, 2)
  image                 String?                   @db.VarChar(255)
  image1                String?                   @db.VarChar(255)
  image2                String?                   @db.VarChar(255)
  image3                String?                   @db.VarChar(255)
  categoryId            BigInt                    @map("id_category")
  createdAt             DateTime                  @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt             DateTime                  @updatedAt @map("updated_at") @db.Timestamp(0)
  orderItems            OrderProducts[]
  deliveryOrderProducts DeliveryOrderHasProduct[]
  category              Category                  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId], map: "products_id_category_fkey")
  @@map("products")
}

model Order {
  id                Int             @id @default(autoincrement())
  name              String          @db.VarChar(255)
  total             Float
  date              DateTime        @default(now())
  status            Boolean         @default(false)
  orderInProgressAt DateTime?       @map("order_in_progress_at")
  orderReadyAT      DateTime?       @map("order_ready_at")
  orderDeliveredAt  DateTime?       @map("order_delivered_at")
  orderType         OrderType       @default(QUIOSCO) @map("order_type")
  anotaciones       String?         @db.Text
  orderProducts     OrderProducts[]

  @@map("orders_quiosco")
}

model OrderProducts {
  id        Int     @id @default(autoincrement())
  orderId   Int     @map("order_id")
  productId BigInt  @map("product_id")
  quantity  Int
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId], map: "order_products_quiosco_order_id_fkey")
  @@index([productId], map: "order_products_quiosco_product_id_fkey")
  @@map("order_products_quiosco")
}

model User {
  id               BigInt          @id @default(autoincrement())
  email            String?         @unique @db.VarChar(100)
  username         String?         @unique @db.VarChar(90)
  name             String          @db.VarChar(90)
  lastname         String?         @db.VarChar(90)
  phone            String?         @unique @db.VarChar(90)
  image            String?         @db.VarChar(255)
  password         String          @db.VarChar(255)
  role             UserRole?
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt        DateTime        @updatedAt @map("updated_at") @db.Timestamp(0)
  addresses        Address[]
  ordersAsClient   DeliveryOrder[] @relation("ClientOrders")
  ordersAsDelivery DeliveryOrder[] @relation("DeliveryOrders")
  roles            UserHasRole[]

  @@map("users")
}

model Role {
  id        BigInt        @id @default(autoincrement())
  name      String        @unique @db.VarChar(90)
  image     String?       @db.VarChar(255)
  route     String        @db.VarChar(180)
  createdAt DateTime      @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime      @updatedAt @map("updated_at") @db.Timestamp(0)
  users     UserHasRole[]

  @@map("roles")
}

model UserHasRole {
  userId    BigInt   @map("id_user")
  roleId    BigInt   @map("id_rol")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(0)
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([roleId], map: "user_has_roles_id_rol_fkey")
  @@map("user_has_roles")
}

model Address {
  id           BigInt          @id @default(autoincrement())
  address      String          @db.VarChar(255)
  neighborhood String          @db.VarChar(180)
  lat          Float
  lng          Float
  userId       BigInt?         @map("id_user")
  createdAt    DateTime        @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt    DateTime        @updatedAt @map("updated_at") @db.Timestamp(0)
  user         User?           @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  orders       DeliveryOrder[]

  @@index([userId], map: "address_id_user_fkey")
  @@map("address")
}

model DeliveryOrder {
  id                BigInt                    @id @default(autoincrement())
  clientId          BigInt?                   @map("id_client")
  deliveryId        BigInt?                   @map("id_delivery")
  addressId         BigInt?                   @map("id_address")
  clientName        String?                   @map("client_name") @db.VarChar(180)
  clientPhone       String?                   @map("client_phone") @db.VarChar(90)
  deliveryAddress   String?                   @map("delivery_address") @db.VarChar(255)
  deliveryNeighborhood String?                @map("delivery_neighborhood") @db.VarChar(180)
  anotaciones       String?                   @db.Text
  lat               Float?
  lng               Float?
  status            String                    @db.VarChar(90)
  timestamp         BigInt
  createdAt         DateTime                  @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt         DateTime                  @updatedAt @map("updated_at") @db.Timestamp(0)
  orderDeliveredAt  DateTime?                 @map("order_delivered_at")
  orderInProgressAt DateTime?                 @map("order_in_progress_at")
  orderReadyAt      DateTime?                 @map("order_ready_at")
  address           Address?                  @relation(fields: [addressId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  client            User?                     @relation("ClientOrders", fields: [clientId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  delivery          User?                     @relation("DeliveryOrders", fields: [deliveryId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  orderProducts     DeliveryOrderHasProduct[]

  @@index([addressId], map: "orders_id_address_fkey")
  @@index([clientId], map: "orders_id_client_fkey")
  @@index([deliveryId], map: "orders_id_delivery_fkey")
  @@map("orders")
}

model DeliveryOrderHasProduct {
  orderId   BigInt        @map("id_order")
  productId BigInt        @map("id_product")
  quantity  BigInt
  createdAt DateTime      @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime      @updatedAt @map("updated_at") @db.Timestamp(0)
  order     DeliveryOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([orderId, productId])
  @@index([productId], map: "orders_has_products_id_product_fkey")
  @@map("orders_has_products")
}

enum UserRole {
  ADMIN
  CHEF
  WAITER
  CLIENTE
  RESTAURANTE
  REPARTIDOR
}

enum OrderType {
  QUIOSCO
  DELIVERY
}
